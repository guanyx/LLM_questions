# 信息图脚本 4：性能优化与上下文管理

**文件名**: `Infographic_Script_4_Optimization.md`
**尺寸**: 1280 x 1714 px
**背景色**: #F8F9FA
**主题**: 如何让 Agent 更快、更省、更聪明

## 1. 标题区 (0, 0) - (1280, 250)
- **背景**: #FFF3E0 (浅橙渐变)
- **主标题**: "性能与优化：缓存与压缩"
  - 字体: 粗体无衬线, 72pt, #E65100
- **副标题**: "Unrolling the Codex Agent Loop - Part 4/4"
  - 字体: 中等无衬线, 36pt, #EF6C00

## 2. Prompt 缓存 (Caching) (50, 280) - (1230, 700)
- **核心原理**: "Prefix Matching (前缀匹配)"
- **视觉对比**:
  - **无缓存**: 每次请求处理量 = O(N^2) -> 红色上升曲线
  - **有缓存**: 仅处理新增部分 = O(N) -> 绿色平缓曲线
- **最佳实践布局**:
  - **静态区 (头部)**: Instructions, Tools (命中率 100%) -> #C8E6C9 (绿)
  - **动态区 (尾部)**: User Context, History (命中率低) -> #FFCCBC (红)
- **陷阱警示**: "MCP 工具列表顺序必须确定！顺序改变 = 缓存失效。"

## 3. 配置变更的“追加”策略 (50, 750) - (1230, 1050)
- **问题**: "中途修改了 CWD 或沙箱设置怎么办？"
- **错误做法**: 修改之前的 System/Developer 消息 -> **破坏前缀，缓存失效** (❌)
- **Codex 做法**: 在 Prompt **末尾追加**新的 `developer` 或 `user` 消息 -> **保留前缀，缓存命中** (✅)
- **视觉**: 积木追加示意图，强调底座不动，只在顶部加盖。

## 4. 上下文压缩 (Compaction) (50, 1100) - (1230, 1450)
- **触发条件**: Token > `auto_compact_limit`
- **流程图**:
  1. **超限**: 历史记录过长
  2. **API 调用**: `/responses/compact`
  3. **转换**: 长历史 -> 单个 `type=compaction` 对象 (含加密状态)
  4. **替换**: 新 Prompt = 指令 + **压缩对象** + 最新消息
- **效果**: 释放上下文空间，同时不丢失“记忆”。

## 5. 零数据保留 (ZDR) (50, 1500) - (1230, 1600)
- **背景**: #ECEFF1 (浅灰)
- **特点**: 无状态设计 (Stateless)
- **机制**: 不使用 `previous_response_id`。所有状态通过 `encrypted_content` 在客户端和服务器间往返 (Round-trip)，服务端不落盘。
- **图标**: 锁 + 循环箭头 (#546E7A)

## 6. 底部信息 (0, 1614) - (1280, 1714)
- **背景**: #ECEFF1
- **导航**: "1. 核心机制 | 2. Prompt 构建 | 3. 执行流 | 4. 性能优化"
  - 当前高亮: "4. 性能优化" (#EF6C00)

## 配色方案
- **主色调**: 橙色系 (#FFF3E0, #FFE0B2, #E65100)
- **功能色**: 绿色 (缓存命中), 红色 (缓存失效/警告)
- **强调**: 清晰的对比度，用于展示数据结构的变化
