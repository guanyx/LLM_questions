# 信息图设计脚本：海量私有文档解析流水线

> **文档来源**：面对海量私有文档（PDF, Word, Excel），如何构建高效的解析（Parsing）流水线？
> **目标尺寸**：1280px x 1714px (竖版系列 x 3)
> **设计风格**：极简、浅色系、模块化、无障碍友好

---

## 🎨 全局视觉规范 (Visual System)

### 1. 配色方案 (Light Theme Only)
所有背景色必须保持极浅，通过边框或文字颜色区分层级，确保 WCAG AA 级对比度。

| 角色 | HEX 码 | 用途说明 |
| :--- | :--- | :--- |
| **画布背景** | `#F8F9FA` | 全局背景，营造纸张质感 |
| **主文本** | `#263238` | 标题、正文核心信息 |
| **次文本** | `#546E7A` | 说明文字、标注 |
| **功能蓝** | `#E3F2FD` (底) / `#1565C0` (文) | 架构框、科技概念、流程 |
| **成功绿** | `#E8F5E9` (底) / `#2E7D32` (文) | Fast Track、通过、清洗后 |
| **警示橙** | `#FFF8E1` (底) / `#EF6C00` (文) | 警告、Slow Track、原始脏数据 |
| **结构紫** | `#F3E5F5` (底) / `#6A1B9A` (文) | JSON、Schema、数据结构 |
| **边框线** | `#CFD8DC` | 分隔线、卡片边框 |

### 2. 布局网格
- **边距 (Padding)**: 上下 80px，左右 60px
- **模块间距**: 40px
- **卡片圆角**: 12px
- **线条风格**: 2px 实线，圆头 (Round Cap)

---

## 🖼️ 画布 1：架构总览与智能分诊 (The Architecture & Routing)

### 1. 顶部区域 (Header) [0px - 250px]
- **背景**: `#F8F9FA`
- **标题**: "海量私有文档解析流水线" (32pt, Bold, `#263238`)
- **副标题**: "一份可落地的工程手册：从非结构化文件到可检索知识" (24pt, Regular, `#546E7A`)
- **核心理念卡片**:
  - **背景**: `#E3F2FD`
  - **文案**: "把解析当成一套'可运营'的数据工程系统，而不是一次性格式转换。"
  - **图标**: 🏭 (工厂流水线 icon, 线性风格)

### 2. 痛点分析 (Why Loader Fails) [250px - 600px]
- **布局**: 左图右文或三列对比
- **标题**: "为什么直接用 Loader 会翻车？"
- **三个视觉模块**:
  1.  **质量失控** (背景 `#FFF8E1`):
      - 视觉: 乱码符号 ``、被打散的表格数字。
      - 文案: "扫描件读不出、表格被打散、乱码污染向量库"
  2.  **成本爆炸** (背景 `#FFF8E1`):
      - 视觉: 燃烧的 GPU 图标 📉。
      - 文案: "全量 OCR 拖死 GPU，长尾任务吞噬预算"
  3.  **事实冲突** (背景 `#FFF8E1`):
      - 视觉: 两个对话气泡互相矛盾。
      - 文案: "修订、批注混入正文，检索到过期内容"

### 3. 总体架构 (5-Layer Architecture) [600px - 1100px]
- **布局**: 垂直堆叠的层级图，用箭头连接。
- **层级设计** (自下而上或流程向右):
  1.  **Ingest** (灰色 `#ECEFF1`): 接入与确权 (ID, URI, ACL)
  2.  **Route** (蓝色 `#E3F2FD`): **分诊 (Fast/Slow)** -> *高亮强调*
  3.  **Parse & Clean** (紫色 `#F3E5F5`): 格式专科处理 (PDF/Office)
  4.  **Normalize** (绿色 `#E8F5E9`): 统一中间态 (Markdown + JSONL)
  5.  **Evaluate** (橙色 `#FFF3E0`): 监控与闭环
- **连接线**: 带有箭头的灰色虚线，表示数据流动。

### 4. 智能分诊 (Route: The Cost Saver) [1100px - 1600px]
- **布局**: 漏斗图 (Funnel) 或 分流图。
- **输入**: 文档图标 (只读第一页)。
- **探针 (Probes)** (中间检测点):
  - 📏 字符数 < 50
  - 🖼️ 图片占比 > 80%
  - 🔣 乱码率 > 20%
- **输出分流**:
  - **➡️ Fast Track (CPU)** (绿色路径): 纯文本提取 -> 90% 文档
  - **↘️ Slow Track (GPU)** (橙色路径): OCR/VLM/多模态 -> 10% 疑难杂症
- **页脚**: "分诊目标：把绝大多数文档送进廉价通道，风险显式记录。"

---

## 🖼️ 画布 2：核心解析与标准化 (Deep Dive: Parse & Normalize)

### 1. 顶部导航 [0px - 150px]
- **标题**: "核心解析策略：格式专科与清洗"
- **面包屑导航**: Route -> **Parse & Clean** -> **Normalize**

### 2. PDF 处理策略 (PDF Strategy) [150px - 700px]
- **布局**: 双栏布局，左侧文本流，右侧表格流。
- **文本层 (Text)**:
  - 工具: `PyMuPDF`
  - 关键词: 坐标、字体、图片信息
- **表格层 (Table) - 重点**:
  - **Detection**: 视觉模型锁定边界 (框选图标)。
  - **Header Re-injection**:
    - *Before*: 切片后变成 [100, 200] (不知所云)
    - *After*: [2023-Q1-Revenue: 100] (自包含)
  - **Flattening**: 多级表头 -> 一维 KV 对。
  - **视觉演示**: 展示一个复杂表格被拆解为带有元数据的 JSON 片段。

### 3. Office 清洗策略 (Office Cleaning) [700px - 1100px]
- **标题**: "Office 文档：噪声 = 事实冲突"
- **三个清洗动作** (使用 Checkbox 列表视觉):
  - ✅ **接受所有修订**: 避免 "~~100万~~ 10万" 被读成 "100万10万"。
  - ✅ **移除批注**: 批注不是事实。
  - ✅ **去重页眉页脚**: 防止 "机密文件" 权重过高。

### 4. 中间态标准化 (Normalization) [1100px - 1600px]
- **概念**: "Markdown 是可读的，JSONL 是可计算的"
- **布局**: 并行输出图。
- **Schema 结构树**:
  - 📄 `doc_id` / `source_hash`
  - 🏷️ `parse_version` (版本控制)
  - 🧱 `blocks[]`:
    - `type`: text/table/image
    - `bbox`: [x1, y1, x2, y2] (用于回溯)
    - `text`: 清洗后文本
    - `table`: 原始 HTML + 结构化 Cells
- **关键策略**:
  - **幂等性**: 同 Hash + 同参数 = 结果不变。
  - **增量更新**: 只重跑受影响版本。

---

## 🖼️ 画布 3：质量运营与工具箱 (Quality & Toolbox)

### 1. 顶部导航 [0px - 150px]
- **标题**: "质量运营与工具选型"
- **面包屑导航**: Normalize -> **Evaluate** -> **Production**

### 2. 质量评估体系 (Evaluation) [150px - 700px]
- **布局**: 金字塔结构 (底宽顶窄)。
- **底层: 启发式规则 (Heuristics)** (自动, 100%覆盖):
  - 检查 Markdown 表格破损。
  - 检查标题层级异常 (`#` 过多)。
  - 检查目录 (TOC) 召回率。
- **中层: 指标监控 (Metrics)** (统计):
  - 乱码率 > 1% ?
  - OCR 占比波动 > 20% ?
  - 失败率 > 0.5% ?
- **顶层: 金标集 (Golden Set)** (回归测试):
  - 每次升级策略，全量跑数十份“金标”样本。

### 3. 工具推荐 (Toolbox) [700px - 1400px]
- **布局**: 货架式网格，每个格子推荐一个工具。
- **综合 PDF**:
  - 🏆 **Docling / MinerU** (端到端转 Markdown)
- **PDF 组件**:
  - 📄 文本: `PyMuPDF` (快)
  - 📊 表格: `pdfplumber` (可调参)
  - 🖼️ 版面: `Surya`
- **OCR**:
  - 🇨🇳 中文: `PaddleOCR` / `RapidOCR`
- **Office**:
  - 📝 Word: `python-docx`
  - 📈 Excel: `pandas`
- **避坑指南 (Warning)** (背景 `#FFF3E0`):
  - ❌ `LangChain PyPDFLoader`: 基础封装，难处理乱码。
  - ⚠️ `Unstructured`: 依赖重，生产慎用。

### 4. 总结 (Takeaway) [1400px - 1650px]
- **背景**: `#E3F2FD`
- **核心价值**:
  - **成本可控**: 分流 + 缓存
  - **质量可控**: 监控 + 金标
  - **生产可控**: 幂等 + 版本化
- **结尾**: "你缺的不是更强的模型，而是可控的流水线。"

---

## 💾 输出检查清单 (Pre-flight Check)
- [ ] 所有文本对比度是否满足 4.5:1 ?
- [ ] 流程图箭头方向是否逻辑一致？
- [ ] 字体大小是否适合移动端阅读 (最小字号不小于 16pt)？
- [ ] 关键代码/Schema 字段是否使用了等宽字体？
