# 信息图设计脚本 2/3：核心解析与标准化 (Parse & Normalize)

> **文档来源**：面对海量私有文档（PDF, Word, Excel），如何构建高效的解析（Parsing）流水线？
> **目标尺寸**：1280px x 1714px (竖版)
> **设计风格**：极简、浅色系、模块化、无障碍友好

---

## 🎨 全局视觉规范 (Visual System)

_(同前，保持一致)_

---

## 🖼️ 画布内容：从“非结构化”到“可计算”

### 1. 顶部区域 (Header) [0px - 200px]

- **背景**: `#F8F9FA`
- **标题**: "格式专科与标准化车间" (32pt, Bold, `#263238`)
- **副标题**: "Parse & Clean ➡️ Normalize：解决异构文档的混乱与噪声" (24pt, Regular, `#546E7A`)
- **核心逻辑线**:
  - [PDF/Office 原件] ➡️ **🔧 专科处理** ➡️ [纯净内容] ➡️ **🏭 标准化** ➡️ [JSONL + Markdown]

---

### 2. PDF 专科：版面还原与多模态提取 [200px - 700px]

_布局：三条并行流水线（文本、图片、表格），展示 PDF 的分层处理。_

#### 2.1 文本层 (Text Layer)

- **视觉**: PyMuPDF ➡️ 纯文本 + 坐标 (BBox)
- **标签**: "Fast Track (文本流)"

#### 2.2 图片层 (Image Layer)

- **视觉**: 提取高分辨率图片 ➡️ VLM (视觉模型) ➡️ Image Caption (文本描述)
- **标签**: "多模态补充"

#### 2.3 表格/版面检测 (Table/Layout Detection)

- **动作**: 视觉模型 (Vision Model) 锁定表格边界，防止误读为散文。
- **输出**: 原始表格切片 ➡️ **送往 Excel 专科处理**

---

### 3. Word 专科：文本清洗与去噪 [700px - 1000px]

_布局：过滤器模型，展示输入前的“脏数据”与输出后的“事实”。_

- **输入**: 充满修订线、批注、重复页眉的“脏”文档。
- **清洗动作 (Facts Extraction)**:
  - ✅ **Accept All Revisions**: "~~100 万~~ 10 万" ➡️ "10 万" (避免证据冲突)
  - ✅ **Remove Comments**: 删除 "老板说要改..." (非最终事实)
  - ✅ **Dedup Headers**: 去除重复 "机密文件" (防止稀释权重)
- **输出**: 无噪声的事实流

---

### 4. Excel & 通用表格引擎：结构化与扁平化 [1000px - 1400px]

_布局：流程图，处理 **Excel 原文件** 和 **PDF 表格切片** 的统一引擎。_

#### 4.1 核心原则：自包含 (Self-contained)

- **定义**: 任意一个表格切片，必须包含能解释其含义的所有元数据（表头、单位、时间）。

#### 4.2 关键技术 (The Table Engine)

- **Step 1: Header Re-injection (表头回注)**
  - 强制将表头注入每一行数据，防止切分后变成“裸数字”。
  - 效果: `| 100 |` ➡️ `[2023-Q1] [营收]: 100`
- **Step 2: Flattening (扁平化)**
  - 将多级表头压平为一维 KV，对系统友好。
  - 规则: "2023 -> Q1 -> 营收" ➡️ Key=`2023-Q1-Revenue`

---

### 5. 标准化车间 (Normalize) [1400px - 1714px]

_布局：展示双管道输出与核心数据结构。_

#### 4.1 双模态输出 (Dual Output)

- **管道 A**: **Markdown** (人眼可读) ➡️ 用于 RAG 切片、LLM 阅读
- **管道 B**: **JSONL / Parquet** (机器可算) ➡️ 用于回溯、统计、审计

#### 4.2 统一 Schema 解剖 (The Anatomy of a Block)

_视觉：一个 JSON 对象的透视图，用引线标注各字段含义。_

```json
{
  "doc_id": "unique_id_123", // 🆔 唯一身份，对齐业务系统
  "parse_version": "v2.0.1", // 🏷️ 版本控制 (解析器升级后可重跑)
  "blocks": [
    {
      "type": "table", // 🧱 类型 (text/table/image...)
      "text": "2023-Q1-Rev: 100...", // 📄 清洗后的内容
      "bbox": [100, 200, 500, 400], // 📍 坐标 (用于高亮回显、顺序修复)
      "table_html": "<table>...</table>", // 📊 原始结构保留
      "warnings": ["low_confidence"] // ⚠️ 探针告警 (链路透传)
    }
  ]
}
```

---

### 5. 页脚 (Footer) [1600px - 1714px]

- **背景**: `#E3F2FD`
- **核心原则**:
  - **幂等性**: 同输入 + 同版本 = 永远同结果。
  - **增量更新**: 只重跑受影响的文档，不搞全量大清洗。

---

## 💾 输出检查清单

- [ ] PDF 表格的“表头回注”是否直观易懂？
- [ ] Office 的“修订”问题是否通过对比展示了危害？
- [ ] JSON Schema 是否使用了等宽字体并进行了语法高亮？
- [ ] 整体流程是否体现了“从脏到净”的过程？
