# 《什么是 DSPy？—— 从 Prompt Engineering 到 Prompt Programming》信息图脚本（1280×1714）

目标：完整覆盖源文档 L1-134 的所有信息，并重排为可顺序阅读的信息图系列。

画布：1280×1714（纵向），单位 px。

阅读路径：从上到下，左到右；每页底部带“进度条 + 下一页提示”。

---

## 0) 全局设计规范（所有画布复用）

### 0.1 网格与边距

- 画布：W=1280, H=1714
- 安全边距：左右 72，上 72，下 88
- 主内容区：x=72..1208，y=72..1626
- 栅格：12 列
  - 列宽 80
  - 列间距 16
  - 内容区总宽 1136（= 12×80 + 11×16）

### 0.2 字体与字号

- 字体：
  - 中文：PingFang SC / Source Han Sans SC（任一可用）
  - 英文与代码：SF Mono / JetBrains Mono（任一可用）
- 字号（建议）：
  - 页标题：44（Bold）
  - 分区标题：28（Semibold）
  - 正文：22（Regular）
  - 注释/辅助：18（Regular）
  - 表格：20（Regular），表头 20（Semibold）
  - 代码：18（Mono Regular），行高 26

### 0.3 颜色（HEX）

- 背景：#0B1220
- 主文字：#EAF0FF
- 次文字：#B7C4E0
- 分隔线/描边：#22304D
- 强调蓝（DSPy）：#4DA3FF
- 强调紫（Teleprompter/编译）：#A78BFA
- 强调绿（Metric/评估）：#34D399
- 强调橙（Prompt Engineering/痛点）：#F59E0B
- 代码底：#0F1A33
- 代码高亮（关键字）：#93C5FD

### 0.4 图标库（极简线性）

- 汇编/扳手：代表“手工 Prompt 调参”
- 文档/字符串：代表“硬编码 Prompt”
- 断裂链：代表“脆弱/不可维护”
- 量尺/仪表：代表“评估困难”
- 代码括号 { }：代表“声明式接口/Schema”
- 芯片：代表“LLM”
- 编译器/齿轮：代表“Teleprompter/编译”
- 靶心：代表“Metric/成功标准”
- 盒子堆叠：代表“Module 组合”
- 箭头流：代表“流程/部署”

### 0.5 组件样式

- 卡片：圆角 16，填充 #0F1A33，描边 #22304D，内边距 18
- 标签 pill：圆角 999，填充使用强调色 20% 透明度，文字用对应强调色
- 流程箭头：线宽 3，颜色 #4B5D86，箭头头部 10×10

### 0.6 导航

- 页脚导航条（所有页一致）：
  - 区域：x=72,y=1638,w=1136,h=48
  - 左侧：文档标题缩写“DSPy：Prompt Programming”
  - 右侧：页码“1/4…4/4”
  - 中间：进度条（4 段）

---

## 1) 系列概览与内容分配（4 张画布）

- 画布 1/4：背景与理念（痛点 → 声明式 + 自优化 → 类比）
- 画布 2/4：核心概念（Signature + Module：Predict/CoT/自定义）
- 画布 3/4：核心概念（Metric + Teleprompter：BootstrapFewShot 原理）
- 画布 4/4：部署方案 + 深度对比（DSPy vs 让 LLM 润色）+ 附录映射表

---

## 2) 画布 1/4：背景与理念（为什么需要 DSPy）

### 2.1 标题区

- 元素：页标题
  - 文本：
    - 主标题：什么是 DSPy？
    - 副标题：从 Prompt Engineering 到 Prompt Programming
  - 位置：x=72,y=72,w=1136,h=120
  - 样式：主标题 44 Bold，副标题 24 Regular（次文字 #B7C4E0）

### 2.2 左侧卡片：传统 Prompt Engineering 的痛点（1.1）

- 卡片 A：x=72,y=220,w=552,h=520
- 标题：传统 Prompt Engineering 的痛点
- 三条要点（每条配图标 + 关键词高亮）：
  1) “汇编语言”式的开发
     - 描述：在代码中硬编码复杂字符串（Prompt），小心调整每一个词
     - 例子（小号文本）："You are a helpful assistant" vs "You are an expert"
  2) 脆弱性与不可维护
     - 描述：Prompt 稍改几个字，效果天差地别；复杂任务 Prompt 冗长、难读、难维护
  3) 评估与迭代困难
     - 描述：难量化修改效果（变好/变差）；模型升级或更换后 Prompt 可能要重写

### 2.3 右侧卡片：DSPy 的解决方案（1.2）

- 卡片 B：x=656,y=220,w=552,h=520
- 标题：DSPy 的解决方案：声明式编程
- 定义块（高亮蓝）：
  - 文本：DSPy (Declarative Self-improving Python)
  - 补充：斯坦福大学 NLP 组推出；将范式从“手写提示词”转为“声明式编程”
- 两条核心特性（各自带 pill 标签）：
  - 声明式 (Declarative)：只需告诉 DSPy“输入是什么、输出是什么、任务描述是什么”
  - 自优化 (Self-improving)：Prompt 措辞、Few-shot 示例选择由编译器 (Teleprompter) 基于数据和评估指标自动生成/优化

### 2.4 底部类比区（类比）

- 区域：x=72,y=770,w=1136,h=780
- 结构：左右对照条 + 中央“编译器”箭头
  - 左列（橙色）：Prompt Engineering = 手写汇编语言
  - 右列（蓝色）：DSPy = 用 Python 写高级代码 → 编译器翻译成 LLM 能理解的指令
  - 中央图形：齿轮/编译器图标 + 箭头指向“LLM 芯片”

### 2.5 Alt 文本（整页）

这页展示 DSPy 的动机：左侧列出传统 Prompt Engineering 的三类痛点（像写汇编、脆弱不可维护、难评估迭代），右侧介绍 DSPy 的声明式与自优化特性，并用类比说明“Prompt Engineering 像手写汇编，DSPy 像用 Python 让编译器翻译成 LLM 指令”。

---

## 3) 画布 2/4：核心概念（Signature + Module）

### 3.1 标题区

- 页标题：核心概念（1）Signatures 与 Modules
- 位置：x=72,y=72,w=1136,h=80

### 3.2 卡片：Signatures（2.1）

- 卡片 C：x=72,y=170,w=1136,h=620
- 左上角标签：Signature（签名）
- 关键句：Signature 是最基础构建块，用于替代传统 Prompt 模板字符串；定义任务的输入输出 Schema

- 代码块（保持源码信息）：
  - 区域：x=96,y=300,w=720,h=360
  - 背景：#0B1736（比代码底更深一点），圆角 12
  - 代码（等宽）：

```python
import dspy

class Translation(dspy.Signature):
    """将文本翻译成指定风格"""
    text = dspy.InputField()
    style = dspy.InputField()
    translation = dspy.OutputField()
```

- 右侧解释列表（逐条对应源文档）：
  - InputField：声明运行时传入的数据占位符（不是读取用户控制台输入，而是函数参数）
  - OutputField：声明模型需要生成的字段
  - Docstring：Prompt 中的 Instruction 部分

### 3.3 卡片：Modules（2.2）

- 卡片 D：x=72,y=820,w=1136,h=740
- 左上角标签：Modules（模块）
- 关键句：Modules 是执行 Signature 的组件，类似 PyTorch 的 Layers

- 三个模块块（横排 3 列，带图标）：
  1) dspy.Predict
     - 说明：最基础模块，直接执行“输入 → 输出”的映射
  2) dspy.ChainOfThought (CoT)
     - 说明：会自动在 Prompt 中插入 Rationale（推理）字段，强制模型在生成结果前先“一步步思考”
     - 小提示：极其强大的模块
  3) 自定义 Module
     - 说明：继承 dspy.Module 串联多个步骤
     - 例子：先检索 → 再思考 → 最后回答

- 示例条（强调“无需改 Prompt”）：
  - 文本：示例：一键开启思维链
  - 代码行：generate_review = dspy.ChainOfThought(ReviewSignature)
  - 注释信息（以标注形式呈现，不写进代码）：只需要改变类名，无需修改 Prompt

### 3.4 Alt 文本（整页）

这页解释 DSPy 的两个核心构件：Signature 用于定义输入输出 Schema，并给出翻译任务的代码示例与 InputField/OutputField/Docstring 的含义；Modules 用于执行 Signature，展示 Predict、ChainOfThought（自动加入 Rationale 推理字段）以及可通过继承 dspy.Module 编排“检索→思考→回答”的自定义模块，并给出一行开启 CoT 的示例。

---

## 4) 画布 3/4：核心概念（Metric + Teleprompter）

### 4.1 标题区

- 页标题：核心概念（2）Metrics 与 Teleprompters
- 位置：x=72,y=72,w=1136,h=80

### 4.2 左侧卡片：Metrics（2.3）

- 卡片 E：x=72,y=170,w=552,h=720
- 标签：Metrics（评估指标）
- 关键句：为了让 DSPy 自动优化，需要定义“什么是好的结果”；通常写一个 Python 函数
- 两类评估（用图标区分）：
  - 基础评估：检查输出长度、格式、是否包含特定关键词
  - Model-based Evaluation（裁判模型）：用小型 LLM 作为裁判，对输出质量（例：犀利程度、准确性）打分

### 4.3 右侧卡片：Teleprompters（2.4）

- 卡片 F：x=656,y=170,w=552,h=720
- 标签：Teleprompters（优化器 / 编译器）
- 关键句：DSPy 的“魔法”；利用 Data（少量样本）+ Metric 来优化 Prompt

- 工作原理（BootstrapFewShot）流程图（纵向 3 步）：
  1) Teacher 模式：尝试运行任务
  2) Bootstrap（引导）：用 Metric 检查输出；若质量高，记录 (Input, Rationale, Output)
  3) Compile（编译）：把收集到的高分示例自动注入 Prompt，作为 Few-shot Demos

### 4.4 底部横条：三者关系图（Data / Metric / Teleprompter）

- 区域：x=72,y=930,w=1136,h=630
- 结构：三节点 + 中央汇合
  - Data（少量样本） →
  - Metric（成功定义） → Teleprompter（编译/优化） → 输出：Optimized Prompt（包含最佳 Few-shot Demos）
  - 在输出旁加小标签：自动生成与优化 Prompt 措辞 + 示例选择

### 4.5 Alt 文本（整页）

这页说明 DSPy 的可优化关键在于 Metric 与 Teleprompter：左侧介绍基础评估与裁判模型两类指标；右侧用 BootstrapFewShot 的三步流程（Teacher 运行、Metric 引导记录高质量 (Input,Rationale,Output)、Compile 注入 Few-shot Demos）解释“编译”如何发生，并在底部画出 Data+Metric 驱动 Teleprompter 产出优化 Prompt 的关系图。

---

## 5) 画布 4/4：跨语言部署 + 深度辨析 + 附录映射表

### 5.1 标题区

- 页标题：落地与辨析：部署方式 + 为什么是 DSPy
- 位置：x=72,y=72,w=1136,h=80

### 5.2 上半区左：跨语言/生产环境部署方案（3）

- 卡片 G：x=72,y=170,w=552,h=620
- 标题：DSPy 作为“离线 Prompt 编译器”
- 适用：非 Python 技术栈（Java / Go / Node.js）团队
- 流程（1→2→3 箭头）：
  1) Python 实验室：开发、评估、编译（优化）
  2) 导出 Prompt（两种方法并列）：
     - 方法 A（保存程序）：compiled_program.save("optimized.json")
     - 方法 B（查看历史）：运行一次预测，用 dspy.settings.lm.inspect_history(n=1) 获取最终完整 Prompt 字符串（含最佳示例）
  3) 线上部署：把导出的 Prompt 字符串配置进生产服务；线上只需字符串拼接，不依赖 Python

### 5.3 上半区右：DSPy vs 直接让 LLM 优化 Prompt（5）

- 卡片 H：x=656,y=170,w=552,h=620
- 标题：DSPy vs “ChatGPT, optimize this prompt”
- 引导句（保持原意）：LLM 润色基于语言学优化；DSPy 基于统计与数据优化

- 对比表（4 行，2 列 + 维度列）：
  - 维度：优化对象
    - LLM 润色：主要优化 Instruction（指令措辞）；例："Translate this" → "You are an expert..."
    - DSPy 编译（BootstrapFewShot）：主要优化 Few-Shot Examples；自动挑选最佳示例并生成推理轨迹（CoT）
  - 维度：驱动源
    - LLM 润色：语言学经验；模型觉得“这样写听起来更专业”
    - DSPy：真实数据与 Metric；不管听起来怎样，以测试集分数为准
  - 维度：示例来源
    - LLM 润色：通常需要人工手写并提供
    - DSPy：自动生成（Bootstrap）；自动补全“解题思路（Rationale）”，创造原始数据里没有的推理轨迹
  - 维度：模型迁移
    - LLM 润色：换模型后效果可能崩，需重新人工调整
    - DSPy：一键重新编译；自动为新模型挑选最适合的示例组合

### 5.4 中部：为什么手动很难凑出完美例子（5.2）

- 横向卡片 I：x=72,y=820,w=1136,h=300
- 标题：为什么说“手动很难凑出完美的例子”？
- 解释块（3 点）：
  1) 自动补全推理：你只提供 Q 和 A；DSPy 尝试生成中间 Rationale（推理过程）
  2) 验证有效性：只有当生成的 Rationale 确实推导出正确 Answer（通过 Metric），例子才会被选中
  3) 组合优化：尝试不同示例组合，找到互补性最强的一组
- 结论句（加粗强调）：你提供“习题与答案”，DSPy 生成“金牌解析”，再编成“教材”

### 5.5 下半区：附录映射表（DSPy 组件 ↔ PyTorch）

- 卡片 J：x=72,y=1140,w=1136,h=420
- 标题：附录：DSPy 组件与 PyTorch 概念映射表
- 表格（5 行）：
  - Signature ↔ Layer Definition：定义输入输出接口（Schema）；适用：所有任务起点
  - Predict ↔ Forward Pass（基础）：执行简单预测任务；适用：简单直观任务
  - ChainOfThought ↔ Forward Pass（高级）：自动加入推理步骤（Rationale）；适用：复杂任务、需要逻辑推导
  - Module ↔ nn.Module：编排多步逻辑；适用：业务逻辑包含多个步骤
  - Teleprompter ↔ Optimizer（如 Adam）：自动优化 Prompt（选例子、改指令）；适用：上线前追求最佳效果
  - Metric ↔ Loss Function：定义评估标准；适用：使用 Teleprompter 时必填

### 5.6 Alt 文本（整页）

这页给出落地方案与关键辨析：左上展示 DSPy 作为离线编译器在非 Python 栈的部署流程（实验室编译、两种导出方式、线上仅字符串拼接）；右上用表格对比 LLM 润色与 DSPy 编译在优化对象、驱动源、示例来源、模型迁移上的差异；中部解释 Bootstrap 机制如何补全并验证 Rationale、再做示例组合优化；底部附录表把 DSPy 的 Signature/Predict/CoT/Module/Teleprompter/Metric 映射到 PyTorch 概念与适用场景。

---

## 6) 内容索引（源文档 → 信息图位置）

- 标题：画布 1 标题区
- 1.1 传统 Prompt Engineering 痛点：画布 1 卡片 A
- 1.2 DSPy 的解决方案（声明式 + 自优化 + Teleprompter）：画布 1 卡片 B + 画布 3 卡片 F
- 类比（Prompt Engineering=汇编，DSPy=Python+编译器）：画布 1 类比区
- 2.1 Signatures（代码 + InputField/OutputField/Docstring）：画布 2 卡片 C
- 2.2 Modules（Predict/CoT/Rationale/自定义 Module + 示例）：画布 2 卡片 D
- 2.3 Metrics（基础评估 + 裁判模型 + 举例“犀利程度/准确性”）：画布 3 卡片 E
- 2.4 Teleprompters（BootstrapFewShot 三步）：画布 3 卡片 F
- 3 跨语言/生产部署（Python 实验室→导出→线上）：画布 4 卡片 G
- 5 深度辨析与对比表：画布 4 卡片 H
- 5.2 手动例子难点与结论（习题/答案→金牌解析→教材）：画布 4 卡片 I
- 附录映射表：画布 4 卡片 J

---

## 7) 图例与可访问性

- 图例：在画布 1 的页脚左侧增加小图例按钮（点击或悬浮展开），列出“颜色含义（橙=Prompt Engineering，蓝=DSPy，绿=Metric，紫=Teleprompter）”与图标含义。
- 对比度：正文文字与背景对比度 ≥ 7:1；次文字用于辅助说明，不承载关键数据。

