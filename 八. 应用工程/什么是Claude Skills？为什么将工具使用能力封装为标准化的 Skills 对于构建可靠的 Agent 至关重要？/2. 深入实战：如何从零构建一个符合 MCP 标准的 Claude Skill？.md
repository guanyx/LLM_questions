# 深入实战：如何从零构建一个符合 MCP 标准的 Claude Skill？

> **前言**：在[上一篇文章](1.%20什么是Claude%20Skills？为什么将工具使用能力封装为标准化的%20Skills%20对于构建可靠的%20Agent%20至关重要？.md)中，我们建立了 Claude Skills 的概念模型。
>
> 今天，我们不写一行代码，而是通过**思维模型**和**架构图解**，把 MCP Skill 的内部运作逻辑彻底讲清楚。这就好比在学习开车前，先弄懂发动机、变速箱和方向盘是如何配合的一样。

---

## 一、 解剖 Skill：它不是脚本，而是“大脑外挂”

初级工程师最容易产生的一个误区是：认为 Skill 只是一个被调用的函数（Function）。
**大错特错！**

想象一下：

- **Claude** 是一个极其聪明但**没有手脚**的指挥官。
- **Skill** 不是指挥官手里的一张纸，而是一个**听命于指挥官的特种兵**。

这个特种兵（Skill）是一个**独立运行的微型服务器（Micro-server）**。它有自己的生命周期，时刻准备着接收指令。

### 🔌 连接方式：USB 线 vs WiFi (stdio vs HTTP)

在 MCP 架构中，Claude 和 Skill 怎么“打电话”？
通常使用的是 `stdio`（标准输入输出），而不是 HTTP。

💡 **通俗类比**：

- **HTTP (WiFi)**：就像你给隔壁楼的同事发邮件。虽然也能沟通，但有延迟，而且如果网断了就失联了。
- **stdio (USB 线)**：就像**大脑直接连接神经**。Claude Desktop 直接启动你的 Skill 程序，就像插上了一根 USB 线。
  - **极速**：没有网络握手，消息瞬间送达。
  - **安全**：这根线是物理连接的（在本地进程内），外面的黑客根本插不进来。

---

## 二、 核心实战：构建“日志侦探”的思维导图

我们要设计一个 **`Log_Detective_Skill`**（日志侦探），让 Claude 能帮我们查服务器日志。
让我们忘掉代码，看看它的**逻辑蓝图**。

### 1. 定义能力 (The Tools)

首先，我们要告诉 Claude 这个 Skill 能干什么。这就像给特种兵发了一套**装备包**。

| 🛠️ 装备 (Tool)    | 📝 说明书 (Description)        | ⚙️ 参数 (Input Schema)                                                          |
| :---------------- | :----------------------------- | :------------------------------------------------------------------------------ |
| **`search_logs`** | “在指定的日志文件中搜索关键词” | 1. `file_path` (文件在哪？)<br>2. `keyword` (搜什么？)<br>3. `limit` (看几行？) |

**关键逻辑**：
Claude 看不到你的底层代码，它只能看到这张**“说明书”**。

- 如果你写得含糊：“搜索文件”，Claude 可能会乱搜。
- 如果你写得精确：“搜索指定路径的文本日志，返回包含关键词的行”，Claude 就能精准操作。

### 2. 制定契约 (The Contract)

在 MCP 中，每一次调用都是一次**严格的契约履行**。

- **请求 (Request)**：Claude 发来一张“工单” —— `{"tool": "search_logs", "path": "/var/log/app.log", "keyword": "Error"}`
- **验证 (Validation)**：Skill 就像一个严谨的办事员，先检查工单填得对不对。
  - 路径是否存在？
  - 关键词是不是空的？
- **响应 (Response)**：Skill 执行完任务，填好“回执单” —— `{"content": "Line 42: Error 500 Connection Failed..."}`

### 3. 错误处理的艺术 (Don't Die, Just Report)

这是最体现 **Agent 思维** 的地方。

在传统编程中，如果文件找不到，程序通常会 `Crash`（崩溃退出）。
但在 Agent 世界里，**Skill 绝对不能死！**

💡 **情景模拟**：

- **❌ 错误做法**：

  - Claude: “请帮我查 `/log/app.log`。”
  - Skill: (文件不存在) -> **崩溃！** -> (连接断开)
  - Claude: “喂？人呢？怎么失联了？” -> **任务失败**

- **✅ 正确做法**：
  - Claude: “请帮我查 `/log/app.log`。”
  - Skill: (文件不存在) -> **保持冷静**，返回一条信息：`"Error: 找不到文件 /log/app.log"`
  - Claude: “哦，看来路径不对。那我先用 `list_files` 看看目录下有哪些文件吧。” -> **自我修复，任务继续**

**结论**：错误信息也是一种**有价值的反馈**。不要抛出异常，要返回描述性的错误文本。

---

## 三、 进阶：注入灵魂 (SOP)

现在的“日志侦探”只会死板地搜索。我们想让它变成**专家**。
这时我们需要引入 **Prompts (提示词模板)**。

这就像给特种兵不仅仅发了枪（Tools），还发了一本**《战术手册》(SOP)**。

### 📖 战术手册：Troubleshoot Protocol

我们在 Skill 里内置一个 Prompt 模板：

> **当用户问“帮我排查错误”时，请按以下步骤行动：**
>
> 1.  先搜日志，不要瞎猜。
> 2.  看到错误日志后，必须检查前后 5 行的上下文。
> 3.  如果是数据库报错，自动检查配置文件。

**效果**：
当用户点击“开始排查”时，Skill 会瞬间把这套 SOP 注入给 Claude。Claude 就不再是一个茫然的通用 AI，而是一个**带着 checklist 工作的资深运维**。

---

## 四、 调试与验证：X 光机 (Inspector)

你怎么知道你的 Skill 是不是在正常工作？
肉眼是看不见 `stdio` 里的电流的。

我们需要一台 **X 光机** —— **MCP Inspector**。

这是一个官方提供的网页调试器。它可以：

1.  **模拟 Claude**：你可以假装自己是 Claude，给 Skill 发指令。
2.  **查看通信**：像看聊天记录一样，看到每一条发出的 JSON 指令和收到的 JSON 回复。
3.  **检查契约**：确认你的“说明书”（Schema）是不是写得跟你想的一样。

---

## 五、 总结：Agentic Engineering 的心法

回顾这一篇，我们没有写一行代码，但我们学到了构建 Skill 的核心心法：

1.  **视角的转变**：你不是在写代码，你是在**定义接口**。Claude 是你的用户，接口文档（Docstring/Schema）比实现逻辑更重要。
2.  **韧性设计**：永远不要让服务崩溃。把错误当成一种通过 `stdout` 返回的信息，给 Agent 修正的机会。
3.  **SOP 代码化**：工具只是手脚，SOP（Prompts）才是灵魂。把专家的经验固化在 Prompt 里，随 Skill 一起分发。

理解了这些逻辑，再去翻看具体的 Python 或 TypeScript 文档，你就会发现一切都顺理成章了。
