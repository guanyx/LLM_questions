# 实战推演：如何设计一个“股票监控 Skill”？

> **前言**：
> 在之前的文章中，我们学会了 Skill 的原理和配置。
> 现在，用户提出了一个非常具体的需求：**“写一个 Skill 监控我的股票持仓”**。
>
> 我们继续坚持**“不写代码，只讲逻辑”**的原则，用**架构师的视角**来拆解这个任务。这不仅仅是关于股票，更是关于如何把一个复杂的业务需求，翻译成 MCP Skill 的语言。

---

## 一、 需求拆解：Agent 到底需要什么？

首先，我们要把模糊的“监控股票”拆解成 Agent 能理解的**原子能力**。

如果 Claude 是你的私人理财顾问，它需要什么信息才能工作？
1.  **你是谁？买了啥？** -> 需要读取你的持仓数据。
2.  **现在的市场咋样？** -> 需要获取实时股价。
3.  **该怎么分析？** -> 需要一套分析逻辑（SOP）。

这就对应了 MCP 的三个核心组件：**Resources（资源）**、**Tools（工具）** 和 **Prompts（提示词）**。

---

## 二、 核心组件设计图

### 1. 资源 (Resources)：你的“账本”

**问题**：你的持仓信息（比如“我有 100 股 Apple，成本 $150”）存在哪？
*   存数据库？太重了。
*   让 Claude 每次问你？太烦了。
*   **最佳方案**：写在一个本地的 CSV 或 JSON 文件里，然后通过 **MCP Resource** 暴露给 Claude。

**设计逻辑**：
*   我们定义一个资源 URI：`stock://portfolio/my_holdings`
*   当 Claude 读取这个资源时，Skill 会去读取你本地的 `portfolio.csv`，并把它转换成文本发给 Claude。
*   **好处**：Claude 不需要知道文件具体在哪，它只需要像访问网址一样访问 `stock://...` 就能看到你的账本。

### 2. 工具 (Tools)：你的“眼睛”

**问题**：Claude 怎么知道现在的股价？它没有联网浏览器的权限（或者太慢）。
我们需要给它一个工具，让它能去调外部 API（比如 Yahoo Finance 或 Alpha Vantage）。

**设计逻辑**：
*   **Tool 名称**：`get_stock_price`
*   **参数 (Schema)**：
    *   `symbol`: 股票代码 (例如 "AAPL", "TSLA")
*   **返回值**：
    *   `price`: 当前价格
    *   `change_percent`: 涨跌幅
    *   `last_updated`: 更新时间

**关键点**：这个工具是**无状态**的。它只负责“查价格”，不负责“分析赚了多少钱”。保持工具的原子性（Atomicity）非常重要。

### 3. 提示词 (Prompts)：你的“大脑”

**问题**：有了账本（Resource）和股价（Tool），Claude 还是不知道该干嘛。它可能只是把价格读出来给你听。
你需要注入**SOP（标准作业程序）**。

**设计逻辑**：
*   我们设计一个 Prompt 叫 **`analyze_portfolio` (分析持仓)**。
*   当用户触发这个 Prompt 时，它会向 Claude 发送一段指令：

> **角色设定**：你是一位华尔街资深分析师。
> **任务流程**：
> 1.  首先，读取 `stock://portfolio/my_holdings` 资源，获取用户的持仓列表。
> 2.  然后，**逐个**调用 `get_stock_price` 工具，查询每一只股票的当前价格。
> 3.  **计算盈亏**：对比成本价和当前价，计算浮动盈亏。
> 4.  **风险预警**：如果某只股票单日跌幅超过 5%，请用**粗体红色**标出，并给出简短的止损建议。
> 5.  最后，生成一份 Markdown 表格汇总报告。

---

## 三、 运行流程推演 (The Flow)

让我们看看当你在 Claude Desktop 里输入“**帮我分析一下今天的持仓**”时，后台发生了什么：

1.  **用户**：在 Claude 界面选择 Prompt `analyze_portfolio`。
2.  **Skill (SOP)**：Skill 把上面那段长长的“华尔街分析师”指令塞进对话框。
3.  **Claude (思考)**：“好的，按照 SOP，第一步我要读账本。” -> **请求读取资源 `stock://...`**
4.  **Skill (Resource)**：读取本地 CSV -> 返回 `[{"symbol": "AAPL", "cost": 150}, ...]`
5.  **Claude (思考)**：“收到了。我有 AAPL 和 TSLA。第二步，查股价。” -> **调用工具 `get_stock_price("AAPL")`**
6.  **Skill (Tool)**：调用 Yahoo API -> 返回 `{"price": 175, "change": "+1.2%"}`
7.  **Claude (思考)**：“AAPL 赚了。再查 TSLA...” -> **调用工具 `get_stock_price("TSLA")`**
8.  **Skill (Tool)**：调用 Yahoo API -> 返回 `{"price": 200, "change": "-6.0%"}`
9.  **Claude (分析)**：“TSLA 跌了 6%，触发 SOP 的风险预警规则！”
10. **最终输出**：Claude 在屏幕上画出一个表格，并用醒目的文字警告你 TSLA 的风险。

---

## 四、 总结

你看，通过这个案例，我们再次验证了 **MCP Skill** 的架构之美：

*   **Resource** 解决了“**数据在哪**”的问题（本地文件）。
*   **Tool** 解决了“**能力边界**”的问题（查实时股价）。
*   **Prompt** 解决了“**业务逻辑**”的问题（怎么算盈亏、什么时候报警）。

不需要复杂的代码，只要理清这个**数据流（Data Flow）**，你就已经完成了一个高级 Skill 的 80% 的设计工作。剩下的，只是填空题而已。
